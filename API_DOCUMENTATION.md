# API Documentation

This document details the REST API and WebSocket API used for communication between the frontend and backend.

## 1. REST API (Flask)
**Base URL:** `/api`

### Device Endpoints
---
#### `GET /api/devices`
* **Description:** Retrieves a list of all devices for the current user.
* **Query Parameters:**
    * `userId` (string): The ID of the user.
* **Success Response (200 OK):**
    ```json
    [
      {
        "id": "DEV_123",
        "name": "Boiler 1",
        "type": "temp_sensor",
        "status": "normal",
        "value": 85.5,
        "unit": "°C",
        "healthScore": 0.95,
        "efficiencyScore": 0.88,
        "location": "Floor 1",
        "timestamp": 1678886400000
      }
    ]
    ```

### Alert Endpoints
---
#### `GET /api/alerts`
* **Description:** Retrieves a list of recent alerts, sorted by timestamp.
* **Query Parameters:**
    * `userId` (string): The ID of the user.
    * `limit` (integer, optional): The number of alerts to return (e.g., 10).
* **Success Response (200 OK):**
    ```json
    [
      {
        "id": "ALERT_789",
        "deviceId": "DEV_123",
        "deviceName": "Boiler 1",
        "timestamp": 1678886430000,
        "severity": "critical",
        "message": "Temperature (85.5°C) exceeds critical threshold (80°C)",
        "acknowledged": false
      }
    ]
    ```

#### `POST /api/alert/acknowledge`
* **Description:** Marks a specific alert as acknowledged.
* **Request Body (JSON):**
    ```json
    {
      "alertId": "ALERT_789"
    }
    ```
* **Success Response (200 OK):**
    ```json
    {
      "status": "success",
      "alertId": "ALERT_789"
    }
    ```

## 2. WebSocket API
**Connection URL:** `ws://<your_domain>/ws`

The WebSocket API pushes real-time updates from the server to the client. The client does not send messages, it only listens.

### Topic: `dashboard_update`
* **Description:** Sent periodically (e.g., every 5 seconds) with updated device data and metrics.
* **Payload (JSON):**
    ```json
    {
      "type": "DATA_UPDATE",
      "payload": {
        "devices": [ ... ], // Full device list
        "dashboardMetrics": { ... } // Overall metrics like system health
      }
    }
    ```

### Topic: `new_alert`
* **Description:** Pushed in real-time as soon as a new critical or warning alert is generated by the AI module.
* **Payload (JSON):**
    ```json
    {
      "type": "NEW_ALERT",
      "payload": {
        "id": "ALERT_790",
        "deviceId": "DEV_124",
        "deviceName": "Turbine 2",
        "timestamp": 1678886500000,
        "severity": "critical",
        "message": "Vibration (12.5) exceeds critical threshold (10.0)",
        "acknowledged": false
      }
    }
    ```